<!DOCTYPE html>
<html lang="mn">
<head>
<meta charset="UTF-8">
<title>–•–ê–ë–≠–ê-2025</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-datalabels/2.2.0/chartjs-plugin-datalabels.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<style>
/* CSS –∫–æ–¥ —Ö—ç–≤—ç—ç—Ä “Ø–ª–¥—ç–Ω—ç */
body{font-family:'Montserrat',sans-serif;margin:0;padding:0;background:#f4f7f6;color:#333;min-width:1000px}
.container{max-width:98%;margin:20px auto;padding:20px;background:#fff;box-shadow:0 4px 8px rgba(0,0,0,0.1);border-radius:8px}
h2,h3{text-align:center;color:#004d40;margin-bottom:20px}
#dataForm{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:30px;padding:15px;border:1px solid #e0e0e0;border-radius:6px;background:#e8f5e9;align-items:center}
#dataForm select,#dataForm input[type="text"],#dataForm input[type="date"],#dataForm input[type="file"],#dataForm button{padding:10px;border:1px solid #ccc;border-radius:4px;font-size:14px;flex:1;min-width:150px}
#dataForm input[type="file"]{padding:5px}
#dataForm button{background:#00796b;color:#fff;cursor:pointer;font-weight:700;transition:background 0.3s}
#dataForm button:hover{background:#004d40}
.export-buttons{text-align:center;margin:20px 0;display:flex;gap:15px;justify-content:center;flex-wrap:wrap}
.export-buttons button{padding:12px 25px;border:none;border-radius:6px;font-size:15px;font-weight:600;cursor:pointer;transition:all 0.3s;color:#fff}
.btn-pdf{background:#d32f2f}.btn-pdf:hover{background:#b71c1c}
.btn-excel{background:#388e3c}.btn-excel:hover{background:#2e7d32}
.btn-json{background:#1976d2}.btn-json:hover{background:#1565c0}
.btn-print{background:#7b1fa2}.btn-print:hover{background:#6a1b9a}
table{width:100%;border-collapse:collapse;margin-top:20px;font-size:13px;table-layout:auto}
th,td{border:1px solid #c8e6c9;padding:10px 8px;text-align:center;word-wrap:break-word;vertical-align:middle}
#dataTable th:nth-child(1){width:2%}
#dataTable th:nth-child(2){width:12%}
#dataTable th:nth-child(3){width:35%}
#dataTable th:nth-child(4){width:10%}
#dataTable th:nth-child(5){width:8%}
#dataTable th:nth-child(6){width:10%}
#dataTable th:nth-child(7){width:11%}
#dataTable th:nth-child(8){width:7%}
th{background:#b2dfdb;color:#004d40;font-weight:700;text-transform:uppercase;font-size:12px}
tr:nth-child(even){background:#f1f8e9}
img{max-width:200px;max-height:200px;height:auto;border-radius:4px;vertical-align:middle;margin:5px 0;cursor:pointer;object-fit:contain}
#dataTable tr td:nth-child(7),#dataTable th:nth-child(7){background:#bbdefb}
#dataTable tr td:nth-child(8),#dataTable th:nth-child(8){background:#c8e6c9}
td select,td input[type="text"]{padding:6px 8px;border:1px solid #a5d6a7;border-radius:3px;background:#fff;width:95%;box-sizing:border-box;font-size:13px}
#categorySummary th{background:#80cbc4}
#categorySummary tfoot td{font-weight:700;background:#4db6ac;color:#fff;font-size:14px}
#detailedSummaryTable th{background:#ffccbc}
#detailedSummaryTable td:nth-child(1){font-weight:700;text-align:left;padding:12px}
#detailedSummaryTable td:nth-child(2){text-align:left;padding:12px}
.chart-container{display:flex;gap:30px;margin:30px 0;flex-wrap:wrap}
.chart-box{flex:1;min-width:450px;background:#fff;padding:20px;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,0.1)}
.chart-box h4{text-align:center;color:#004d40;margin-bottom:15px;font-size:16px}
canvas{max-height:350px}
@media print{.export-buttons,#dataForm,td select,td input[type="text"]{display:none!important}body{background:#fff}.container{box-shadow:none;max-width:100%}}
.modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.9)}
.modal-content{margin:auto;display:block;max-width:90%;max-height:90%;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}
.close{position:absolute;top:15px;right:35px;color:#f1f1f1;font-size:40px;font-weight:700;cursor:pointer}
.close:hover{color:#bbb}
</style>
</head>
<body>
<div class="container">
<h2>–ó–∞–º—ã–Ω ...-—Ä –∞–Ω–≥–∏–π–Ω ...-—Ä —Ö—ç—Å—ç–≥</h2>
<h2>–•”®–î”®–õ–ú”®–†–ò–ô–ù –ê–Æ–£–õ–ì“Æ–ô –ë–ê–ô–î–ê–õ, –≠–†“Æ“Æ–õ –ê–•–£–ô - 2026</h2>
<div class="export-buttons">
<button class="btn-pdf" onclick="exportToPDF()">üìÑ PDF</button>
<button class="btn-excel" onclick="exportToExcel()">üìä Excel</button>
<button class="btn-json" onclick="exportToJSON()">üíæ JSON</button>
<button class="btn-print" onclick="window.print()">üñ®Ô∏è –•—ç–≤–ª—ç—Ö</button>
</div>
<form id="dataForm">
<select id="category">
<option value="–ë–∞–≥–∞–∂ —Ö—ç—Ä—ç–≥—Å—ç–ª, —Ç–æ–Ω–æ–≥ —Ç”©—Ö”©”©—Ä”©–º–∂—Ç—ç–π —Ö–æ–ª–±–æ–æ—Ç–æ–π">–ë–∞–≥–∞–∂ —Ö—ç—Ä—ç–≥—Å—ç–ª, —Ç–æ–Ω–æ–≥ —Ç”©—Ö”©”©—Ä”©–º–∂—Ç—ç–π —Ö–æ–ª–±–æ–æ—Ç–æ–π</option>
<option value="–ú–∞—à–∏–Ω—Ç–∞–π —Ö–æ–ª–±–æ–æ—Ç–æ–π">–ú–∞—à–∏–Ω—Ç–∞–π —Ö–æ–ª–±–æ–æ—Ç–æ–π</option>
<option value="–¶–∞—Ö–∏–ª–≥–∞–∞–Ω—ã —É—Ç–∞—Å, –º–æ–Ω—Ç–∞–∂—Ç–∞–π —Ö–æ–ª–±–æ–æ—Ç–æ–π">–¶–∞—Ö–∏–ª–≥–∞–∞–Ω—ã —É—Ç–∞—Å, –º–æ–Ω—Ç–∞–∂—Ç–∞–π —Ö–æ–ª–±–æ–æ—Ç–æ–π</option>
<option value="–ê–∂–ª—ã–Ω —Ö—É–≤—Ü–∞—Å, —Ö–∞–º–≥–∞–∞–ª–∞—Ö —Ö—ç—Ä—ç–≥—Å—ç–ª—Ç—ç–π —Ö–æ–ª–±–æ–æ—Ç–æ–π">–ê–∂–ª—ã–Ω —Ö—É–≤—Ü–∞—Å, —Ö–∞–º–≥–∞–∞–ª–∞—Ö —Ö—ç—Ä—ç–≥—Å—ç–ª—Ç—ç–π —Ö–æ–ª–±–æ–æ—Ç–æ–π</option>
<option value="–ë–∏—á–∏–≥ –±–∞—Ä–∏–º—Ç, —Å—É—Ä–≥–∞–ª—Ç—Ç–∞–π —Ö–æ–ª–±–æ–æ—Ç–æ–π">–ë–∏—á–∏–≥ –±–∞—Ä–∏–º—Ç, —Å—É—Ä–≥–∞–ª—Ç—Ç–∞–π —Ö–æ–ª–±–æ–æ—Ç–æ–π</option>
<option value="–ì–∞–ª—ã–Ω –∞—é—É–ª–≥“Ø–π –±–∞–π–¥–∞–ª—Ç–∞–π —Ö–æ–ª–±–æ–æ—Ç–æ–π">–ì–∞–ª—ã–Ω –∞—é—É–ª–≥“Ø–π –±–∞–π–¥–∞–ª—Ç–∞–π —Ö–æ–ª–±–æ–æ—Ç–æ–π</option>
<option value="–ë—É—Å–∞–¥">–ë—É—Å–∞–¥</option>
</select>
<input type="text" id="foundItem" placeholder="–ò–ª—ç—Ä—Å—ç–Ω “Ø–ª —Ç–æ—Ö–∏—Ä–æ–ª" required>
<input type="file" id="photo" accept="image/*">
<input type="date" id="deadline" required>
<button type="submit">–ù—ç–º—ç—Ö</button>
</form>
<h3>–ë“Ø—Ö –±“Ø—Ä—Ç–≥—ç–ª</h3>
<table><thead><tr><th>‚Ññ</th><th>–ê–Ω–≥–∏–ª–∞–ª</th><th>–ò–ª—ç—Ä—Å—ç–Ω “Ø–ª —Ç–æ—Ö–∏—Ä–æ–ª / –ó—É—Ä–∞–≥</th><th>–•–∞—Ä–∏—É—Ü–∞—Ö –∞–∂–∏–ª—Ç–∞–Ω</th><th>–•—É–≥–∞—Ü–∞–∞</th><th>“Æ–∑–ª—ç–≥ —Ö–∏–π—Å—ç–Ω –∞–∂–∏–ª—Ç–∞–Ω</th><th>–ì“Ø–π—Ü—ç—Ç–≥—ç–ª</th><th>“Æ–π–ª–¥—ç–ª</th></tr></thead><tbody id="dataTable"></tbody></table>
<h3>–ê–Ω–≥–∏–ª–ª—ã–Ω —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫</h3>
<div class="chart-container">
<div class="chart-box"><h4>–•“Ø—Å–Ω—ç–≥—Ç</h4><table><thead><tr><th>–ê–Ω–≥–∏–ª–∞–ª</th><th>–ù–∏–π—Ç “Ø–ª —Ç–æ—Ö–∏—Ä–æ–ª</th><th>–•—É–≤—å (%)</th></tr></thead><tbody id="categorySummary"></tbody><tfoot><tr><td>–ù–ò–ô–¢</td><td id="totalCount">0</td><td>100%</td></tr></tfoot></table></div>
<div class="chart-box"><h4>–ì—Ä–∞—Ñ–∏–∫</h4><canvas id="categoryChart"></canvas></div>
</div>
<h3>–ì“Ø–π—Ü—ç—Ç–≥—ç–ª–∏–π–Ω –¥—ç–ª–≥—ç—Ä—ç–Ω–≥“Ø–π —Ç–∞–π–ª–∞–Ω</h3>
<div class="chart-container">
<div class="chart-box"><h4>–•“Ø—Å–Ω—ç–≥—Ç</h4><table id="detailedSummaryTable"><thead><tr><th>–ì“Ø–π—Ü—ç—Ç–≥—ç–ª–∏–π–Ω —Å—Ç–∞—Ç—É—Å</th><th>–¢–∞–π–ª–±–∞—Ä</th></tr></thead><tbody id="performanceSummary"></tbody></table></div>
<div class="chart-box"><h4>–ì—Ä–∞—Ñ–∏–∫</h4><canvas id="performanceChart"></canvas></div>
</div>
</div>
<div id="imageModal" class="modal"><span class="close" onclick="closeModal()">&times;</span><img class="modal-content" id="modalImage"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
<script>
let data=JSON.parse(localStorage.getItem("tableData"))||[];let catChart=null,perfChart=null;

// “Æ–∑–ª—ç–≥ —Ö–∏–π—Å—ç–Ω –∞–∂–∏–ª—Ç–Ω—ã –∂–∞–≥—Å–∞–∞–ª—Ç (Select —Ü—ç—Å—ç–Ω–¥ –∞—à–∏–≥–ª–∞–Ω–∞)
const INSPECTORS = [
    "–°–æ–Ω–≥–æ–Ω–æ —É—É", 
    "–ö–æ–º–∏—Å—Å—ã–Ω –±“Ø—Ä—ç–ª–¥—ç—Ö“Ø“Ø–Ω",
    "–ü–î",
    "–ü–î–ë–∫",
    "–ü–î–ë—Ä",
    "–ü–î–ë—Å",
    "–ø—Ä"
];

document.getElementById("dataForm").addEventListener("submit",e=>{
    e.preventDefault();
    let c=document.getElementById("category").value,
        f=document.getElementById("foundItem").value,
        p=document.getElementById("photo"),
        d=document.getElementById("deadline").value;
    
    if(c&&f&&d){
        if(p.files.length>0){
            let r=new FileReader();
            // –ó—É—Ä–≥–∏–π–≥ Base64 string –±–æ–ª–≥–æ—Ö
            r.onload=e=>saveEntry(c,f,e.target.result.split(",")[1],d);
            r.readAsDataURL(p.files[0])
        }else {
            saveEntry(c,f,"",d);
        }
        document.getElementById("dataForm").reset()
    }
});

function saveEntry(c,f,p,d){
    let o=prompt("–•–∞—Ä–∏—É—Ü–∞—Ö –∞–∂–∏–ª—Ç–∞–Ω:")||"–¢–æ–¥–æ—Ä—Ö–æ–π–≥“Ø–π";
    // inspector-–∏–π–≥ —ç—Ö–ª—ç—ç–¥ "–°–æ–Ω–≥–æ–Ω–æ —É—É" —ç—Å–≤—ç–ª —Ö–æ–æ—Å–æ–Ω —É—Ç–≥–∞–∞—Ä —Ö–∞–¥–≥–∞–ª–Ω–∞.
    data.push({category:c,foundItem:f,photoURL:p,owner:o,deadline:d,inspector:INSPECTORS[0],status:"–ë–∏–µ–ª—ç—ç–≥“Ø–π"});
    localStorage.setItem("tableData",JSON.stringify(data));
    loadTable();
}

function loadTable(){
    let t=document.getElementById("dataTable"),
        cs=document.getElementById("categorySummary"),
        ps=document.getElementById("performanceSummary");
    
    t.innerHTML="";
    cs.innerHTML="";
    ps.innerHTML="";
    
    let cc={}, // Category Count
        sg={}, // Status Group
        total=0;

    data.forEach((item,i)=>{
        cc[item.category]=(cc[item.category]||0)+1;
        total++;
        
        // --- FIX 1: –ì“Ø–π—Ü—ç—Ç–≥—ç–ª—Ç—ç–π –∞–∂–ª—É—É–¥—ã–≥ –±“Ø—Ö —Å—Ç–∞—Ç—É—Å–∞–∞—Ä –Ω—å –±“Ø–ª—ç–≥–ª—ç—Ö ---
        sg[item.status]=sg[item.status]||[];
        sg[item.status].push({foundItem:item.foundItem,owner:item.owner})
        // -------------------------------------------------------------
        
        // “Æ–∑–ª—ç–≥ —Ö–∏–π—Å—ç–Ω –∞–∂–∏–ª—Ç–Ω—ã —Ü—ç—Å–Ω–∏–π —Å–æ–Ω–≥–æ–ª—Ç—É—É–¥—ã–≥ “Ø“Ø—Å–≥—ç—Ö
        let inspectorOptions = INSPECTORS.map(name => 
            `<option value="${name}" ${item.inspector === name ? "selected" : ""}>${name}</option>`
        ).join('');
        
        // –•“Ø—Å–Ω—ç–≥—Ç–∏–π–Ω –º”©—Ä “Ø“Ø—Å–≥—ç—Ö
        let r=document.createElement("tr");
        let photoDisplay = item.photoURL 
            ? '<img src="data:image/png;base64,'+item.photoURL+'" onclick="openModal(\'data:image/png;base64,'+item.photoURL+'\')">' 
            : '';

        r.innerHTML = `
            <td>${i+1}</td>
            <td>${item.category}</td>
            <td>
                <div style="text-align:left;padding:8px">${item.foundItem}</div>
                ${photoDisplay}
            </td>
            <td>${item.owner}</td>
            <td>${item.deadline}</td>
            <td>
                <select onchange="updateInspector(${i},this.value)">
                    ${inspectorOptions}
                </select>
            </td>
            <td>
                <select onchange="updateStatus(${i},this.value)">
                    <option ${item.status==="–ë–∏–µ–ª—ç—ç–≥“Ø–π"?"selected":""}>–ë–∏–µ–ª—ç—ç–≥“Ø–π</option>
                    <option ${item.status==="–ë–∏–µ–ª—ç—Å—ç–Ω"?"selected":""}>–ë–∏–µ–ª—ç—Å—ç–Ω</option>
                    <option ${item.status==="–ú–∞—Ç–µ—Ä–∏–∞–ª —Ö–∞–Ω–≥–∞–≥–¥–∞–∞–≥“Ø–π"?"selected":""}>–ú–∞—Ç–µ—Ä–∏–∞–ª —Ö–∞–Ω–≥–∞–≥–¥–∞–∞–≥“Ø–π</option>
                    <option ${item.status==="–•—É–≥–∞—Ü–∞–∞ –±–æ–ª–æ–æ–≥“Ø–π"?"selected":""}>–•—É–≥–∞—Ü–∞–∞ –±–æ–ª–æ–æ–≥“Ø–π</option>
                    <option ${item.status==="–ó–∞—Å–≤–∞—Ä—Ç ”©–≥—Å”©–Ω"?"selected":""}>–ó–∞—Å–≤–∞—Ä—Ç ”©–≥—Å”©–Ω</option>
                </select>
            </td>
            <td>
                <select onchange="handleAction(${i},this.value)">
                    <option value="">—Ö–∞–¥–≥–∞–ª–∞—Ö</option>
                    <option value="delete">–£—Å—Ç–≥–∞—Ö</option>
                </select>
            </td>
        `;
        t.appendChild(r);
    });

    document.getElementById("totalCount").textContent=total;
    
    // –ê–Ω–≥–∏–ª–ª—ã–Ω —Ö—É—Ä–∞–∞–Ω–≥—É–π (–•“Ø—Å–Ω—ç–≥—Ç)
    for(let c in cc){
        let r=document.createElement("tr");
        r.innerHTML=`<td>${c}</td><td>${cc[c]}</td><td>${((cc[c]/total)*100).toFixed(1)}%</td>`;
        cs.appendChild(r);
    }

    // --- FIX 2: –ì“Ø–π—Ü—ç—Ç–≥—ç–ª–∏–π–Ω –¥—ç–ª–≥—ç—Ä—ç–Ω–≥“Ø–π —Ç–∞–π–ª–∞–Ω (–•“Ø—Å–Ω—ç–≥—Ç)-–¥ –±“Ø—Ö —Å—Ç–∞—Ç—É—Å—ã–≥ –æ—Ä—É—É–ª–∞—Ö ---
    const performanceStatuses = ["–ë–∏–µ–ª—ç—ç–≥“Ø–π", "–ë–∏–µ–ª—ç—Å—ç–Ω", "–ú–∞—Ç–µ—Ä–∏–∞–ª —Ö–∞–Ω–≥–∞–≥–¥–∞–∞–≥“Ø–π", "–•—É–≥–∞—Ü–∞–∞ –±–æ–ª–æ–æ–≥“Ø–π", "–ó–∞—Å–≤–∞—Ä—Ç ”©–≥—Å”©–Ω"];
    let hasPerformanceData = false;

    performanceStatuses.forEach(s => {
        let items = sg[s] || [];
        if (items.length > 0) {
            hasPerformanceData = true;
            let fr = document.createElement("tr");
            
            // –≠—Ö–Ω–∏–π –º”©—Ä–∏–π–Ω rowspan
            fr.innerHTML = `
                <td rowspan="${items.length}">${s} (${items.length})</td>
                <td><b>${items[0].foundItem}</b> / ${items[0].owner}</td>
            `;
            ps.appendChild(fr);

            // –î–∞—Ä–∞–∞–≥–∏–π–Ω –º”©—Ä“Ø“Ø–¥
            for (let i = 1; i < items.length; i++) {
                let nr = document.createElement("tr");
                nr.innerHTML = `<td><b>${items[i].foundItem}</b> / ${items[i].owner}</td>`;
                ps.appendChild(nr);
            }
        }
    });

    if (!hasPerformanceData && total > 0) { // –ù–∏–π—Ç –±“Ø—Ä—Ç–≥—ç–ª –±–∞–π–≥–∞–∞ —á —Å—Ç–∞—Ç—É—Å—É—É–¥ –¥—ç—ç—Ä —Ö—É–≤–∞–∞–≥–¥–∞–∞–≥“Ø–π –±–æ–ª
        ps.innerHTML='<tr><td colspan="2" style="text-align:center">–û–¥–æ–æ–≥–æ–æ—Ä –±“Ø—Ä—Ç–≥—ç–ª“Ø“Ø–¥ —Å—Ç–∞—Ç—É—Å–∞–∞—Ä —Ö—É–≤–∞–∞–≥–¥–∞–∞–≥“Ø–π –±–∞–π–Ω–∞.</td></tr>';
    } else if (total === 0) {
         ps.innerHTML='<tr><td colspan="2" style="text-align:center">–û–¥–æ–æ–≥–æ–æ—Ä –±“Ø—Ä—Ç–≥—ç–ª –±–∞–π—Ö–≥“Ø–π –±–∞–π–Ω–∞.</td></tr>';
    }
    // ----------------------------------------------------------------------------------

    updateCharts(cc,sg);
}

function updateCharts(cc,sg){
    let labels=Object.keys(cc),
        values=Object.values(cc),
        total=values.reduce((a,b)=>a+b,0);
    
    // –ê–Ω–≥–∏–ª–ª—ã–Ω –≥—Ä–∞—Ñ–∏–∫ (Bar Chart)
    if(catChart)catChart.destroy();
    catChart=new Chart(document.getElementById("categoryChart"),{
        type:'bar',
        data:{
            labels,
            datasets:[{
                data:values,
                backgroundColor:['rgba(129,199,132,0.8)','rgba(255,183,77,0.8)','rgba(79,195,247,0.8)','rgba(229,115,115,0.8)','rgba(186,104,200,0.8)','rgba(174,213,129,0.8)','rgba(255,138,101,0.8)'],
                borderColor:['rgba(67,160,71,1)','rgba(255,152,0,1)','rgba(3,169,244,1)','rgba(229,57,53,1)','rgba(142,36,170,1)','rgba(139,195,74,1)','rgba(255,87,34,1)'],
                borderWidth:2
            }]
        },
        options:{
            responsive:true,
            plugins:{
                legend:{display:false},
                datalabels:{
                    anchor:'end',
                    align:'top',
                    formatter:v=>v+'\n('+((v/total)*100).toFixed(1)+'%)',
                    font:{weight:'bold',size:12},
                    color:'#004d40'
                }
            },
            scales:{
                y:{beginAtZero:true,ticks:{stepSize:1}}
            }
        },
        plugins:[ChartDataLabels]
    });

    // --- FIX 3: –ì“Ø–π—Ü—ç—Ç–≥—ç–ª–∏–π–Ω –≥—Ä–∞—Ñ–∏–∫ (Doughnut Chart)-–¥ –±“Ø—Ö —Å—Ç–∞—Ç—É—Å—ã–≥ –æ—Ä—É—É–ª–∞—Ö ---
    let pl=[],pv=[];
    // –ë“Ø—Ö 5 —Å—Ç–∞—Ç—É—Å—ã–≥ —Ç–æ–æ—Ü–æ–æ–Ω–¥ –æ—Ä—É—É–ª–Ω–∞
    const performanceStatuses = ["–ë–∏–µ–ª—ç—ç–≥“Ø–π", "–ë–∏–µ–ª—ç—Å—ç–Ω", "–ú–∞—Ç–µ—Ä–∏–∞–ª —Ö–∞–Ω–≥–∞–≥–¥–∞–∞–≥“Ø–π", "–•—É–≥–∞—Ü–∞–∞ –±–æ–ª–æ–æ–≥“Ø–π", "–ó–∞—Å–≤–∞—Ä—Ç ”©–≥—Å”©–Ω"]; 
    performanceStatuses.forEach(s=>{
        let c=(sg[s]||[]).length;
        if(c>0){
            pl.push(s);
            pv.push(c);
        }
    });
    let pt=pv.reduce((a,b)=>a+b,0); // –ù–∏–π—Ç –≥“Ø–π—Ü—ç—Ç–≥—ç–ª–∏–π–Ω —Ç–æ–æ –Ω—å –æ–¥–æ–æ –Ω–∏–π—Ç –±“Ø—Ä—Ç–≥—ç–ª–∏–π–Ω —Ç–æ–æ—Ç–æ–π —Ç—ç–Ω—Ü—ç–Ω—ç (total = pt)
    
    if(perfChart)perfChart.destroy();
    perfChart=new Chart(document.getElementById("performanceChart"),{
        type:'doughnut',
        data:{
            labels:pl,
            datasets:[{
                data:pv,
                // 5 —Å—Ç–∞—Ç—É—Å—Ç —Ç–æ—Ö–∏—Ä—É—É–ª—Å–∞–Ω —à–∏–Ω—ç ”©–Ω–≥”©–Ω–∏–π –∂–∞–≥—Å–∞–∞–ª—Ç (–ë–∏–µ–ª—ç—ç–≥“Ø–π–≥ —ç—Ö—ç–Ω–¥ —É–ª–∞–∞–Ω–∞–∞—Ä)
                backgroundColor:['rgba(229,57,53,0.8)','rgba(76,175,80,0.8)','rgba(255,152,0,0.8)','rgba(33,150,243,0.8)','rgba(156,39,176,0.8)'], 
                borderColor:['rgba(198,40,40,1)','rgba(56,142,60,1)','rgba(245,124,0,1)','rgba(25,118,210,1)','rgba(123,31,162,1)'],
                borderWidth:3
            }]
        },
        options:{
            cutout:'55%',
            plugins:{
                legend:{
                    position:'bottom',
                    labels:{
                        generateLabels:c=>c.data.labels.map((l,i)=>{
                            let v=c.data.datasets[0].data[i];
                            let percent = pt > 0 ? ((v/pt)*100).toFixed(1) : 0;
                            return{
                                text:l+': '+v+' ('+percent+'%)',
                                fillStyle:c.data.datasets[0].backgroundColor[i],
                                index:i
                            }
                        })
                    }
                },
                datalabels:{
                    formatter:(v)=>pt > 0 ? v+'\n'+((v/pt)*100).toFixed(1)+'%' : v,
                    color:'#fff',
                    font:{weight:'bold',size:13}
                }
            }
        },
        plugins:[ChartDataLabels,{
            id:'centerText',
            beforeDraw:c=>{
                let ctx=c.ctx;
                ctx.save();
                let x=(c.chartArea.left+c.chartArea.right)/2,
                    y=(c.chartArea.top+c.chartArea.bottom)/2;
                ctx.textAlign='center';
                ctx.textBaseline='middle';
                ctx.font='bold 24px Montserrat';
                ctx.fillStyle='#004d40';
                ctx.fillText(pt,x,y-10);
                ctx.font='14px Montserrat';
                ctx.fillStyle='#00796b';
                ctx.fillText('–ù–∏–π—Ç',x,y+15);
                ctx.restore();
            }
        }]
    })
    // ----------------------------------------------------------------------------------
}

function updateStatus(i,v){
    data[i].status=v;
    localStorage.setItem("tableData",JSON.stringify(data));
    loadTable();
}

function updateInspector(i,v){
    data[i].inspector=v;
    localStorage.setItem("tableData",JSON.stringify(data));
    // loadTable() –¥—É—É–¥–∞—Ö–≥“Ø–π
}

function handleAction(i,a){
    if(a==="delete"&&confirm("–£—Å—Ç–≥–∞—Ö —É—É?")){
        data.splice(i,1);
        localStorage.setItem("tableData",JSON.stringify(data));
        loadTable();
    }
}

function openModal(src){
    document.getElementById("imageModal").style.display="block";
    document.getElementById("modalImage").src=src;
}

function closeModal(){
    document.getElementById("imageModal").style.display="none";
}

function exportToPDF(){
    html2pdf().from(document.querySelector(".container")).save("–•–ê–ë–≠–ê-2025.pdf");
}

function exportToExcel(){
    let csv="\ufeff‚Ññ,–ê–Ω–≥–∏–ª–∞–ª,“Æ–ª —Ç–æ—Ö–∏—Ä–æ–ª,–•–∞—Ä–∏—É—Ü–∞—Ö,–•—É–≥–∞—Ü–∞–∞,“Æ–∑–ª—ç–≥—á,–ì“Ø–π—Ü—ç—Ç–≥—ç–ª\n";
    
    data.forEach((item,i) => {
        csv += `${i+1},${item.category},"${item.foundItem.replace(/"/g, '""')}",${item.owner},${item.deadline},${item.inspector},${item.status}\n`;
    });

    let link=document.createElement("a");
    link.href=encodeURI("data:text/csv;charset=utf-8,"+csv);
    link.download="–•–ê–ë–≠–ê-2025.csv";
    link.click();
}

function exportToJSON(){
    let link=document.createElement("a");
    link.href=URL.createObjectURL(new Blob([JSON.stringify(data,null,2)],{type:"application/json"}));
    link.download="–•–ê–ë–≠–ê-2025.json";
    link.click();
}

loadTable();
</script>
</body>
</html>
